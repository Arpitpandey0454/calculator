<!doctype html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CTC Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="./output.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // Tailwind Config with dark mode enabled
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { inter: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#3b82f6',
                        accent: '#8b5cf6',
                        gray: {
                            800: '#1f2937',
                            900: '#111827',
                            950: '#030712'
                        }
                    }
                }
            }
        }

        // Dark Mode Initializer
        ; (function () {
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Prevent layout shift from scrollbar appearance/disappearance */
        html {
            overflow-y: scroll;
        }

        /* --- YEH AAPKA NAYA BACKGROUND STYLE HAI --- */
        .bg-arpit-gradient {
            background-image:
                /* faint top vignette (darkening) */
                radial-gradient(1200px 300px at 50% 0%,
                    rgba(0, 0, 0, 0.12),
                    transparent 30%),
                /* soft diagonal streak for subtle depth */
                linear-gradient(135deg,
                    rgba(255, 255, 255, 0.04) 0%,
                    rgba(0, 0, 0, 0.02) 100%),
                /* main smooth mint -> blue -> very pale */
                linear-gradient(90deg,
                    #e8fbf2 0%,
                    #dff4ef 18%,
                    #eaf3ff 55%,
                    #f2f7fb 100%);
            background-repeat: no-repeat;
            background-size: cover;
        }

        /* Use a fixed pseudo-element to render the background + filter so that
			      `position: fixed` children (header) remain fixed to the viewport. */
        .bg-arpit-gradient::before {
            content: '';
            position: fixed;
            inset: 0;
            /* top:0; right:0; bottom:0; left:0; */
            z-index: -1;
            background-image:
                /* faint top vignette (darkening) */
                radial-gradient(1200px 300px at 50% 0%,
                    rgba(0, 0, 0, 0.12),
                    transparent 30%),
                /* soft diagonal streak for subtle depth */
                linear-gradient(135deg,
                    rgba(255, 255, 255, 0.04) 0%,
                    rgba(0, 0, 0, 0.02) 100%),
                /* main smooth mint -> blue -> very pale */
                linear-gradient(90deg,
                    #e8fbf2 0%,
                    #dff4ef 18%,
                    #eaf3ff 55%,
                    #f2f7fb 100%);
            background-repeat: no-repeat;
            background-size: cover;
            /* gentle overall desaturation/softness */
            filter: saturate(0.98) contrast(0.98);
            pointer-events: none;
        }

        /* --- DARK MODE BACKGROUND OVERRIDE --- */
        .dark .bg-arpit-gradient::before {
            background-image: none;
            background-color: #030712;
            /* gray-950 */
            filter: none;
        }

        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        /* --- Improved Slider Styles --- */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 9999px;
            background: linear-gradient(to right, #0d9488 0%, #0d9488 var(--value, 0%), transparent var(--value, 0%), transparent 100%);
            background-color: #e5e7eb;
            /* gray-200 */
            outline: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .dark input[type="range"] {
            background-color: #374151;
            /* gray-700 */
        }

        input[type="range"]::-webkit-slider-runnable-track {
            background: transparent;
            height: 8px;
            border-radius: 9999px;
        }

        input[type="range"]::-moz-range-track {
            background: transparent;
            border: none;
        }

        /* --- Slider Thumb --- */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0d9488;
            /* teal-600 */
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: -6px;
            /* Center thumb on track */
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0d9488;
            /* teal-600 */
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .dark input[type="range"]::-webkit-slider-thumb {
            border: 3px solid #1f2937;
            /* gray-800 */
        }

        .dark input[type="range"]::-moz-range-thumb {
            border: 3px solid #1f2937;
            /* gray-800 */
        }

        /* --- Tab Styles --- */
        .tab-btn {
            @apply py-2 px-3 sm:px-4 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-white/80 dark:hover:bg-gray-700/80 font-medium transition-all text-sm;
        }

        .tab-btn.tab-active {
            @apply font-semibold text-teal-800 dark:text-teal-100 bg-white dark:bg-gray-900 shadow-md;
        }

        /* --- Modal Styles --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: 10% auto;
            padding: 24px;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            background: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            color: #374151;
            /* text-gray-700 */
        }

        .dark .modal-content {
            background: #1f2937;
            /* gray-800 */
            border: 1px solid #4b5563;
            /* gray-600 */
            color: #e5e7eb;
            /* gray-200 */
        }

        .close-modal {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
            color: #9ca3af;
            /* text-gray-400 */
        }

        .close-modal:hover {
            color: #374151;
        }

        /* text-gray-700 */
        .dark .close-modal:hover {
            color: #fff;
        }

        /* --- Premium Minimal Header with Glassmorphism --- */
        header {
            /* Fix: Center header by default */
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            width: 100%; /* Default to full width on mobile */
            max-width: 100%;

            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(232, 251, 242, 0.8) 50%, rgba(234, 243, 255, 0.75) 100%);
            backdrop-filter: blur(16px) saturate(120%);
            -webkit-backdrop-filter: blur(16px) saturate(120%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);

            /* Premium multi-layered soft shadows */
            box-shadow:
                0 1px 3px rgba(0, 0, 0, 0.08),
                0 8px 24px rgba(13, 148, 136, 0.08),
                0 16px 48px rgba(59, 130, 246, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);

            transition: all 280ms cubic-bezier(0.4, 0, 0.2, 1);
            will-change: box-shadow, background; /* transform removed from here */
            z-index: 50;
            overflow: hidden;
        }

        /* For large screens, constrain the header width */
        @media (min-width: 1024px) {
            header {
                width: 70%; 
                max-width: 100%; 
            }
        }
        
        /* Floating blob shapes in header background */
        header::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle at 40% 50%, rgba(13, 148, 136, 0.08), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: blob-float 8s ease-in-out infinite;
            z-index: 0;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -20%;
            left: -5%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at 60% 40%, rgba(59, 130, 246, 0.06), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: blob-float 10s ease-in-out infinite reverse;
            z-index: 0;
        }

        @keyframes blob-float {

            0%,
            100% {
                transform: translateY(0px) scale(1);
            }

            50% {
                transform: translateY(15px) scale(1.05);
            }
        }

        /* Header hover effect - floating lift */
        header:hover {
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.12),
                0 12px 32px rgba(13, 148, 136, 0.12),
                0 24px 64px rgba(59, 130, 246, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            /* FIX: Removed transform: translateY(-2px); to fix side-shifting */
        }

        /* Scrolled state - enhanced frosted glass effect */
        header.scrolled {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(232, 251, 242, 0.85) 50%, rgba(234, 243, 255, 0.8) 100%);
            backdrop-filter: blur(20px) saturate(130%);
            -webkit-backdrop-filter: blur(20px) saturate(130%);
            border-bottom: 1px solid rgba(13, 148, 136, 0.1);
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.1),
                0 16px 40px rgba(13, 148, 136, 0.12),
                0 32px 80px rgba(59, 130, 246, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            padding: 8px 0;
            /* --- NEW ANIMATION PROPERTIES --- */
            width: 100% !important;
            max-width: 100% !important;
            top: 0 !important;
            border-radius: 0 !important;
            left: 0 !important;
            transform: none !important; /* FIX: Added back to ensure it overrides fixed center CSS for full width */
        }

        /* --- NEW: Expand inner content when scrolled --- */
        header.scrolled .max-w-5xl {
            max-width: 95% !important;
            /* Expands from 1024px to 95% of screen */
            padding-left: 1.5rem; /* Re-add horizontal padding for content */
            padding-right: 1.5rem;
        }

        /* Dark mode header styling */
        .dark header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(20, 35, 50, 0.85) 50%, rgba(25, 38, 55, 0.82) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow:
                0 1px 3px rgba(0, 0, 0, 0.3),
                0 8px 24px rgba(13, 148, 136, 0.1),
                0 16px 48px rgba(59, 130, 246, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        .dark header:hover {
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.4),
                0 12px 32px rgba(13, 148, 136, 0.15),
                0 24px 64px rgba(59, 130, 246, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
            /* FIX: Removed transform: translateY(-2px); */
        }

        .dark header.scrolled {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(20, 35, 50, 0.9) 50%, rgba(25, 38, 55, 0.88) 100%);
            border-bottom: 1px solid rgba(13, 148, 136, 0.15);
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.4),
                0 16px 40px rgba(13, 148, 136, 0.15),
                0 32px 80px rgba(59, 130, 246, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            padding: 12px 0;
        }

        /* Header content wrapper with proper z-index */
        header>div {
            position: relative;
            z-index: 10;
        }

        /* Premium navigation styling */
        header nav {
            position: relative;
            z-index: 10;
        }

        /* Smooth underline indicator for tabs */
        .tab-btn {
            position: relative;
            padding-bottom: 6px;
            color: #6b7280;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: color 280ms ease;
        }

        .dark .tab-btn {
            color: #9ca3af;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #0d9488, #0e7490);
            transition: width 320ms cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tab-btn:hover::after {
            width: 100%;
        }

        .tab-btn.tab-active {
            color: #0d9488;
        }

        .dark .tab-btn.tab-active {
            color: #14b8a6;
        }

        .tab-btn.tab-active::after {
            width: 100%;
            background: linear-gradient(90deg, #0d9488, #14b8a6);
        }

        /* Floating Glass Logo Box */
        .footer-logo-box {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(14px) saturate(120%);
            border: 1px solid rgba(255, 255, 255, 0.8);
            padding: 10px 14px;
            border-radius: 16px;
            box-shadow:
                0 4px 14px rgba(0, 0, 0, 0.08),
                0 12px 38px rgba(13, 148, 136, 0.10),
                0 20px 60px rgba(59, 130, 246, 0.10);
            transition: all .35s ease;
        }

        /* Logo Image */
        .footer-logo-img {
            width: 70px;
            height: auto;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.18));
            transition: all .35s ease;
        }

        /* Hover animation */
        .footer-logo-box:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.1),
                0 16px 40px rgba(13, 148, 136, 0.15),
                0 30px 70px rgba(59, 130, 246, 0.12);
        }

        .footer-logo-box:hover .footer-logo-img {
            transform: scale(1.09);
        }


        /* --- Premium Footer Styles --- */
        footer {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #e8fbf2 0%, #dff4ef 25%, #eaf3ff 60%, #f2f7fb 100%);
            border: none;
            margin-top: 0;
            transition: all 300ms ease;
        }

        /* Smooth blob/curve background elements */
        footer::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle at 30% 40%, rgba(13, 148, 136, 0.08), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }

        footer::after {
            content: '';
            position: absolute;
            bottom: -30%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle at 60% 50%, rgba(59, 130, 246, 0.06), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 10s ease-in-out infinite reverse;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(30px);
            }
        }

        /* Dark mode footer */
        .dark footer {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.8) 0%, rgba(15, 23, 42, 0.85) 50%, rgba(30, 41, 59, 0.82) 100%);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        footer .max-w-5xl {
            position: relative;
            z-index: 10;
        }

        footer>div {
            position: relative;
            z-index: 10;
        }

        /* Soft shadow and elevated feel */
        footer {
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.4), 0 -8px 20px rgba(0, 0, 0, 0.04);
        }

        .dark footer {
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.05), 0 -8px 20px rgba(0, 0, 0, 0.2);
        }

        /* Card-like sections in footer */
        footer .grid>div {
            /* REVERTING to ensure responsive stacking on mobile */
            /* Removed card-like styling for pure link sections */
        }
        
        /* Footer headings */
        footer h4 {
            background: linear-gradient(135deg, #0d9488 0%, #0e7490 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .dark footer h4 {
            background: linear-gradient(135deg, #14b8a6 0%, #22d3ee 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Footer links enhanced */
        footer a,
        footer .footer-tab-btn {
            position: relative;
            transition: all 300ms ease;
            color: #4b5563;
        }

        .dark footer a,
        .dark footer .footer-tab-btn {
            color: #9ca3af;
        }

        footer a::after,
        footer .footer-tab-btn::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #0d9488, #0e7490);
            transition: width 300ms ease;
        }

        footer a:hover::after,
        footer .footer-tab-btn:hover::after {
            width: 100%;
        }

        footer a:hover,
        footer .footer-tab-btn:hover {
            color: #0d9488;
            transform: translateX(2px);
        }

        .dark footer a:hover,
        .dark footer .footer-tab-btn:hover {
            color: #14b8a6;
        }

        /* Bottom divider - elegant minimal */
        footer .mt-12 {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            border: none !important;
            height: 1px;
            position: relative;
            z-index: 10;
        }

        .dark footer .mt-12 {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        /* Copyright text elegant */
        footer .text-center p {
            color: #6b7280;
            font-size: 0.875rem;
            letter-spacing: 0.3px;
            font-weight: 500;
        }

        .dark footer .text-center p {
            color: #9ca3af;
        }
    </style>
</head>

<body class="min-h-screen bg-arpit-gradient text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <header class="fixed w-full top-0 z-50 border-b border-gray-200/80 dark:border-white/10 lg:rounded-bl-[30px] lg:rounded-br-[30px] transition-all" style="left: 50%; transform: translateX(-50%);">
        <div class="max-w-5xl mx-auto flex justify-between items-center px-4 sm:px-6 py-3">
            <div class="flex items-center gap-3">
                <img src="logo.png" alt="CTC Calculator Logo" class="h-[80px] w-[80px] object-contain">
            </div>

            <div class="flex items-center space-x-2">

                <div class="hidden sm:flex items-center space-x-2 text-sm">
                    <a href="#about-section" class="tab-btn py-1 px-3">About</a>
                    <a href="#faq-section" class="tab-btn py-1 px-3">FAQs</a>
                    <a href="#" class="tab-btn py-1 px-3">Blog</a>
                </div>
                <button id="theme-toggle"
                    class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors">
                    <svg id="theme-icon-light" class="w-6 h-6 hidden" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                    <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                        </path>
                    </svg>
                </button>

                <button id="mobile-menu-toggle"
                    class="sm:hidden p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <nav id="mobile-menu"
            class="hidden sm:block w-full border-t border-gray-200/80 dark:border-white/10 sm:border-t-0 bg-white dark:bg-gray-900 sm:bg-transparent dark:sm:bg-transparent">
            <div
                class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-center w-full sm:space-x-8 text-gray-500 text-sm sm:text-base font-extrabold p-4 sm:p-0 sm:max-w-5xl mx-auto space-y-2 sm:space-y-0">
                <button class="tab-btn tab-active" data-tab="ctc-to-inhand">CTC → In-hand</button>
                <button class="tab-btn" data-tab="inhand-to-ctc">In-hand → CTC</button>
                <button class="tab-btn" data-tab="compare">Compare Offers</button>
                <button class="tab-btn" data-tab="tax">Tax Calculator</button>
                <button class="tab-btn" data-tab="hike">Hike Calculator</button>
                <button class="tab-btn" data-tab="additional">Additional Calculator</button>
            </div>
        </nav>
    </header>
    
    <main class="container mx-auto px-4 py-8 relative z-10 pt-40 sm:pt-48">

        <div id="tab-content">

            <div id="ctc-to-inhand" class="tab-panel">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">

                    <div
                        class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">

                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 font-medium mb-4">Enter your Annual
                                CTC</label>
                            <div
                                class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                                <div class="w-full sm:flex-1">
                                    <div
                                        class="flex items-center bg-gray-200 dark:bg-gray-700 rounded-full w-full sm:w-auto sm:min-w-[130px] px-4 py-2">
                                        <span class="text-gray-600 dark:text-gray-300 font-medium">₹</span>
                                        <input type="number" id="ctcInputBox"
                                            class="w-full bg-transparent text-gray-700 dark:text-gray-200 font-medium text-right focus:outline-none"
                                            value="1000000" step="10000" min="100000" max="10000000">
                                    </div>
                                    <p id="ctcInWords" class="mt-2 text-sm text-gray-600 dark:text-gray-400">One million
                                        rupees</p>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div class="space-y-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">Tax Regime & Location</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Regime:</span>
                                <div class="flex items-center space-x-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="taxRegime" value="new" checked
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:ring-teal-500">
                                        <span class="ml-2 text-gray-700 dark:text-gray-300">New</span>
                                    </label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="taxRegime" value="old"
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:ring-teal-500">
                                        <span class="ml-2 text-gray-700 dark:text-gray-300">Old</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label for="location"
                                    class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Location</label>
                                <select id="location"
                                    class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                    <option value="TN">Tamil Nadu</option>
                                    <option value="KA">Karnataka</option>
                                    <option value="MH">Maharashtra</option>
                                    <option value="DL">Delhi</option>
                                </select>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div class="space-y-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">Salary Components</h3>
                                <div class="flex items-center space-x-2 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="inputMode" value="percentage" checked
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-800 focus:ring-teal-500">
                                        <span class="ml-1 text-sm text-gray-700 dark:text-gray-300">%</span>
                                    </label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="inputMode" value="amount"
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-800 focus:ring-teal-500">
                                        <span class="ml-1 text-sm text-gray-700 dark:text-gray-300">₹</span>
                                    </label>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="basicInput" class="text-sm text-gray-600 dark:text-gray-400">Basic <span
                                            class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="basicInput" value="40"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 text-right focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                </div>
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="hraInput" class="text-sm text-gray-600 dark:text-gray-400">HRA <span
                                            class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="hraInput" value="40" readonly
                                        title="HRA = 40% of Basic (fixed)"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 text-right focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                </div>
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="daInput" class="text-sm text-gray-600 dark:text-gray-400">DA <span
                                            class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="daInput" value="10"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 text-right focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                </div>
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="ltaInput" class="text-sm text-gray-600 dark:text-gray-400">LTA <span
                                            class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="ltaInput" value="5"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 text-right focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                </div>
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="bonusInput" class="text-sm text-gray-600 dark:text-gray-400">Bonus <span
                                            class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="bonusInput" value="10"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 text-right focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                </div>
                                <div class="flex justify-between items-center space-x-4">
                                    <label for="specialInput" class="text-sm text-gray-600 dark:text-gray-400">Special
                                        <span class="component-label font-bold ml-1">(%)</span></label>
                                    <input type="number" id="specialInput" value="15"
                                        class="w-28 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 opacity-70 cursor-not-allowed"
                                        readonly>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div class="space-y-3">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">Deductions & Benefits</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="includePF" checked
                                    class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">EPF Applicable</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="includeGratuity" checked
                                    class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">Gratuity (4.81% of Basic)</span>
                            </label>
                            <div class="flex items-center space-x-2">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="includeInsurance"
                                        class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                    <span class="ml-2 text-gray-700 dark:text-gray-300">Insurance (fixed)</span>
                                </label>
                                <input type="number" id="insuranceAmount" value="12000"
                                    class="w-32 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200">
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="includeOtherDeductions"
                                        class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                    <span class="ml-2 text-gray-700 dark:text-gray-300">Other Deductions
                                        (Employer)</span>
                                </label>
                                <input type="number" id="otherDeductionsAmount" value="0"
                                    class="w-32 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200">
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="includeNps"
                                        class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                    <span class="ml-2 text-gray-700 dark:text-gray-300">NPS (Employee)</span>
                                </label>
                                <input type="number" id="npsPercent" value="0" min="0" max="12"
                                    class="w-20 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200">%
                            </div>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="includeProfTax" checked
                                    class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">Professional Tax</span>
                            </label>
                        </div>

                    </div>

                    <div
                        class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">
                        <h2 id="regimeTitle" class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Salary
                            Breakdown</h2>

                        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg text-center">
                            <p class="text-center text-gray-600 dark:text-gray-400 text-sm">Net Monthly Salary</p>
                            <h3 class="text-3xl font-bold text-center text-teal-600 dark:text-teal-400"
                                id="monthlyInHand">₹0</h3>
                            <p class="text-center text-gray-500 dark:text-gray-500 text-sm mt-2">Net Annual: <span
                                    id="netYearly" class="font-medium text-gray-600 dark:text-gray-400">₹0</span></p>
                        </div>

                        <canvas id="salaryChart" class="max-h-64 sm:max-h-72"></canvas>

                        <div>
                            <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Earnings Breakdown (Annual)
                            </h3>
                            <div class="space-y-2 text-sm" id="earningsBreakdown">
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Basic
                                        Salary</span> <span id="basicAmount"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">HRA</span> <span id="hraAmount"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">DA</span> <span id="daAmount"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">LTA</span> <span id="ltaAmount"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Special
                                        Allowance</span> <span id="specialAmount"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Performance Bonus</span> <span
                                        id="bonusAmount" class="font-medium text-gray-900 dark:text-gray-100">₹0</span>
                                </div>
                                <div
                                    class="flex justify-between font-semibold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-gray-900 dark:text-gray-100">
                                    <span>Gross Salary</span> <span id="grossYearly">₹0</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Tax Calculation</h3>
                            <div class="space-y-2 text-sm" id="taxBreakdown">
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Gross
                                        Salary</span> <span id="grossForTax"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between text-red-600 dark:text-red-400">
                                    <span>Standard Deduction</span> <span id="standardDeduction">-₹0</span>
                                </div>
                                <div
                                    class="flex justify-between font-semibold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-gray-900 dark:text-gray-100">
                                    <span>Taxable Income</span> <span id="taxableIncome">₹0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">

                        <div>
                            <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Deductions (Annual)</h3>
                            <div class="space-y-2 text-sm" id="deductionsBreakdown">
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">EPF
                                        (Employee)</span> <span id="epfEmployee"
                                        class="text-red-600 dark:text-red-400 font-medium">₹0</span></div>
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">EPF
                                        (Employer)</span> <span id="epfEmployer"
                                        class="text-gray-800 dark:text-gray-200 font-medium">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Gratuity (Employer)</span> <span
                                        id="gratuityEmployer"
                                        class="text-gray-800 dark:text-gray-200 font-medium">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Insurance (Employer)</span> <span
                                        id="insuranceEmployer"
                                        class="text-gray-800 dark:text-gray-200 font-medium">₹0</span></div>
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Other
                                        Deductions (Employer)</span> <span id="otherEmployerDeduction"
                                        class="text-gray-800 dark:text-gray-200 font-medium">₹0</span></div>
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">NPS
                                        (Employee)</span> <span id="npsDeduction" class="text-red-400">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Professional Tax</span> <span
                                        id="profTaxAmount" class="text-red-600 dark:text-red-400 font-medium">₹0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 dark:text-gray-400">Income Tax</span>
                                    <div class="flex items-center">
                                        <span id="incomeTax"
                                            class="text-red-600 dark:text-red-400 font-medium mr-2">₹0</span>
                                        <button id="showTaxDetails"
                                            class="text-teal-600 dark:text-teal-400 hover:text-teal-700 dark:hover:text-teal-300 text-xs font-medium">(Details)</button>
                                    </div>
                                </div>
                                <div
                                    class="flex justify-between font-semibold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-red-700 dark:text-red-400">
                                    <span>Total Deductions</span> <span id="deductionsYearly">₹0</span>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div>
                            <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Cost to Company Breakup</h3>
                            <div class="space-y-2 text-sm bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Gross
                                        Salary</span> <span id="grossSalaryCtc"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Employer EPF</span> <span
                                        id="employerEpfCtc"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Gratuity (Employer)</span> <span
                                        id="gratuityEmployerCtc"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div class="flex justify-between"><span
                                        class="text-gray-600 dark:text-gray-400">Insurance (Employer)</span> <span
                                        id="insuranceEmployerCtc"
                                        class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                <div
                                    class="flex justify-between font-bold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-gray-900 dark:text-gray-100">
                                    <span>Total CTC</span> <span id="totalCtc">₹0</span>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div>
                            <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Download Report</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button id="downloadPdf"
                                    class="flex items-center justify-center bg-teal-600 text-white px-4 py-3 rounded-lg hover:bg-teal-700 dark:bg-teal-600 dark:hover:bg-teal-700 font-semibold transition-all">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    PDF
                                </button>
                                <button id="downloadExcel"
                                    class="flex items-center justify-center bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 font-semibold transition-all">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="inhand-to-ctc" class="tab-panel hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                    <div
                        class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Calculate CTC from
                            In-hand</h2>

                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 font-medium mb-4">Desired Net Monthly
                                In-hand</label>
                            <div
                                class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                                <div class="w-full sm:flex-1">
                                    <div
                                        class="flex items-center bg-gray-200 dark:bg-gray-700 rounded-full w-full sm:w-auto sm:min-w-[130px] px-4 py-2">
                                        <span class="text-gray-600 dark:text-gray-300 font-medium">₹</span>
                                        <input type="number" id="monthlyInHandInputBox"
                                            class="w-full bg-transparent text-gray-700 dark:text-gray-200 font-medium text-right focus:outline-none"
                                            value="70000" step="1000" min="10000" max="500000">
                                    </div>
                                    <p id="monthlyInWords" class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                        Seventy thousand rupees</p>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div class="space-y-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">Tax Regime & Location</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Regime:</span>
                                <div class="flex items-center space-x-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="taxRegime_reverse" value="new" checked
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:ring-teal-500">
                                        <span class="ml-2 text-gray-700 dark:text-gray-300">New</span>
                                    </label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="taxRegime_reverse" value="old"
                                            class="h-4 w-4 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:ring-teal-500">
                                        <span class="ml-2 text-gray-700 dark:text-gray-300">Old</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label for="location_reverse"
                                    class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Location</label>
                                <select id="location_reverse"
                                    class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 px-3 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all">
                                    <option value="TN">Tamil Nadu</option>
                                    <option value="KA">Karnataka</option>
                                    <option value="MH">Maharashtra</option>
                                    <option value="DL">Delhi</option>
                                </select>
                            </div>
                        </div>

                        <hr class="border-gray-200/80 dark:border-gray-700/80">

                        <div class="space-y-3">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">Assumed Deductions</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="includePF_reverse" checked
                                    class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">EPF Applicable</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="includeProfTax_reverse" checked
                                    class="h-5 w-5 text-teal-600 dark:text-teal-500 border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 focus:ring-teal-500">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">Professional Tax</span>
                            </label>
                        </div>

                        <button id="calculateReverse"
                            class="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 rounded-full transition-colors duration-200 shadow-lg">
                            Calculate Required CTC
                        </button>
                    </div>

                    <div id="reverseResultCard" class="lg:col-span-2 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                            <div
                                class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">
                                <h2 id="reverseRegimeTitle"
                                    class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Required CTC
                                    Breakdown</h2>

                                <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg text-center">
                                    <p class="text-center text-gray-600 dark:text-gray-400 text-sm">Required Annual CTC
                                    </p>
                                    <h3 class="text-3xl font-bold text-center text-blue-600 dark:text-blue-400"
                                        id="calculatedCTC">₹0</h3>
                                    <p class="text-center text-gray-500 dark:text-gray-500 text-sm mt-2">Gives Net
                                        Monthly: <span id="calculatedMonthlyInHand"
                                            class="font-medium text-gray-600 dark:text-gray-400">₹0</span></p>
                                </div>

                                <canvas id="reverseSalaryChart" class="max-h-64 sm:max-h-72"></canvas>

                                <div>
                                    <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Cost to Company
                                        Breakup</h3>
                                    <div class="space-y-2 text-sm bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Gross Salary</span> <span
                                                id="reverse_grossSalaryCtc"
                                                class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Employer EPF</span> <span
                                                id="reverse_employerEpfCtc"
                                                class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                        <div
                                            class="flex justify-between font-bold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-gray-900 dark:text-gray-100">
                                            <span>Total CTC</span> <span id="reverse_totalCtc">₹0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 space-y-6">
                                <div>
                                    <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Earnings Breakdown
                                        (Annual)</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Basic Salary</span> <span
                                                id="reverse_basicAmount"
                                                class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">HRA</span> <span
                                                id="reverse_hraAmount"
                                                class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Allowances</span> <span
                                                id="reverse_specialAmount"
                                                class="font-medium text-gray-900 dark:text-gray-100">₹0</span></div>
                                        <div
                                            class="flex justify-between font-semibold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-gray-900 dark:text-gray-100">
                                            <span>Gross Salary</span> <span id="reverse_grossYearly">₹0</span>
                                        </div>
                                    </div>
                                </div>

                                <hr class="border-gray-200/80 dark:border-gray-700/80">

                                <div>
                                    <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Deductions (Annual)
                                    </h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">EPF (Employee)</span> <span
                                                id="reverse_epfEmployee"
                                                class="text-red-600 dark:text-red-400 font-medium">₹0</span></div>
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Professional Tax</span> <span
                                                id="reverse_profTaxAmount"
                                                class="text-red-600 dark:text-red-400 font-medium">₹0</span></div>
                                        <div class="flex justify-between"><span
                                                class="text-gray-600 dark:text-gray-400">Income Tax</span> <span
                                                id="reverse_incomeTax"
                                                class="text-red-600 dark:text-red-400 font-medium">₹0</span></div>
                                        <div
                                            class="flex justify-between font-semibold border-t border-gray-300 dark:border-gray-700 pt-2 mt-2 text-red-700 dark:text-red-400">
                                            <span>Total Deductions</span> <span id="reverse_deductionsYearly">₹0</span>
                                        </div>
                                    </div>
                                </div>

                                <hr class="border-gray-200/80 dark:border-gray-700/80">

                                <div>
                                    <h3 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">Download Report</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <button id="downloadPdf_reverse"
                                            class="flex items-center justify-center bg-teal-600 text-white px-4 py-3 rounded-lg hover:bg-teal-700 dark:bg-teal-600 dark:hover:bg-teal-700 font-semibold transition-all">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            PDF
                                        </button>
                                        <button id="downloadExcel_reverse"
                                            class="flex items-center justify-center bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 font-semibold transition-all">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="compare" class="tab-panel hidden">
                <div
                    class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 max-w-3xl mx-auto text-center">
                    <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Compare Two CTC Offers</h3>
                    <p class="text-gray-600 dark:text-gray-400">Coming Soon...</p>
                </div>
            </div>

            <div id="tax" class="tab-panel hidden">
                <div
                    class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 max-w-3xl mx-auto text-center">
                    <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Tax Calculator (Old vs New)
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400">Coming Soon...</p>
                </div>
            </div>

            <div id="hike" class="tab-panel hidden">
                <div
                    class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 max-w-3xl mx-auto text-center">
                    <h3 class="2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Hike Calculator</h3>
                    <p class="text-gray-600 dark:text-gray-400">Coming Soon...</p>
                </div>
            </div>

            <div id="additional" class="tab-panel hidden">
                <div
                    class="bg-white/60 dark:bg-gray-900 backdrop-blur-lg rounded-3xl shadow-xl dark:shadow-none border border-gray-200/50 dark:border-gray-800 p-6 sm:p-8 max-w-3xl mx-auto text-center">
                    <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Additional Calculator</h3>
                    <p class="text-gray-600 dark:text-gray-400">Coming Soon...</p>
                </div>
            </div>

        </div>
    </main>

    <section id="about-section" class="max-w-5xl mx-auto px-4 py-20">

        <div class=" mt-20">
            <h2
                class="text-4xl font-bold mb-4 bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 bg-clip-text text-transparent dark:from-teal-200 dark:via-cyan-200 dark:to-blue-200 text-center">
                About the CTC Calculator
            </h2>
            <div
                class="bg-white/60 dark:bg-gray-900/40 backdrop-blur-xl border border-white/50 dark:border-gray-800 rounded-3xl p-10 shadow-[0_8px_25px_rgba(0,0,0,0.06)]">


                <p class="text-gray-700 dark:text-gray-300 leading-relaxed mt-4">
                    This calculator helps you understand the breakdown of your Cost to Company (CTC) and estimate your
                    in-hand salary. It accounts for common deductions like Employee Provident Fund (EPF), Professional
                    Tax, and Income Tax under both the Old and New Tax Regimes.
                </p>
                <p class="text-gray-700 dark:text-gray-300 leading-relaxed mt-3">
                    Please note that this is an estimation tool. The final salary and tax calculations may vary based on
                    your company's specific policies and your complete financial profile. It's always a good idea to
                    consult with a financial advisor for exact figures.
                </p>
            </div>

        </div>

        <div id="faq-section" class="mt-20">
            <h2
                class="text-4xl font-extrabold mb-10 bg-gradient-to-r from-blue-700 via-teal-600 to-teal-700 bg-clip-text text-transparent dark:from-cyan-300 dark:via-teal-200 dark:to-blue-200 text-center">
                Frequently Asked Questions
            </h2>

            <div class="space-y-6">

                <div class="faq-card bg-white/60 dark:bg-gray-900/40 backdrop-blur-xl border border-white/50 dark:border-gray-800 rounded-2xl p-6 shadow-md cursor-pointer transition-all"
                    onclick="toggleFAQ(this)">
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-gray-100">1. What is CTC (Cost to
                            Company)?</h3>
                        <span class="faq-icon text-2xl text-teal-600 dark:text-teal-300 transition-all">+</span>
                    </div>
                    <p class="faq-answer text-gray-700 dark:text-gray-300 mt-3 hidden">
                        CTC stands for 'Cost to Company'. It is the total amount that a company spends on an employee,
                        directly or indirectly. It includes your gross salary, employer's contribution to EPF, gratuity
                        (if applicable), and any other benefits.
                    </p>
                </div>

                <div class="faq-card bg-white/60 dark:bg-gray-900/40 backdrop-blur-xl border border-white/50 dark:border-gray-800 rounded-2xl p-6 shadow-md cursor-pointer transition-all"
                    onclick="toggleFAQ(this)">
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-gray-100">2. Old vs New Tax Regime?</h3>
                        <span class="faq-icon text-2xl text-teal-600 dark:text-teal-300 transition-all">+</span>
                    </div>
                    <p class="faq-answer text-gray-700 dark:text-gray-300 mt-3 hidden">
                        Old: more deductions (HRA, LTA, 80C)
                        New: lower tax slabs but fewer exemptions.
                    </p>
                </div>

                <div class="faq-card bg-white/60 dark:bg-gray-900/40 backdrop-blur-xl border border-white/50 dark:border-gray-800 rounded-2xl p-6 shadow-md cursor-pointer transition-all"
                    onclick="toggleFAQ(this)">
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-gray-100">3. How is EPF calculated?
                        </h3>
                        <span class="faq-icon text-2xl text-teal-600 dark:text-teal-300 transition-all">+</span>
                    </div>
                    <p class="faq-answer text-gray-700 dark:text-gray-300 mt-3 hidden">
                        EPF = 12% of Basic Salary (employee) + 12% employer contribution.
                    </p>
                </div>

            </div>
        </div>

    </section>

    <script>
        function toggleFAQ(card) {
            const answer = card.querySelector(".faq-answer");
            const icon = card.querySelector(".faq-icon");
            const isOpen = !answer.classList.contains("hidden");

            // Close all other cards
            document.querySelectorAll(".faq-answer").forEach(a => a.classList.add("hidden"));
            document.querySelectorAll(".faq-icon").forEach(i => i.textContent = "+");

            // Toggle current
            if (!isOpen) {
                answer.classList.remove("hidden");
                icon.textContent = "−";
            }
        }
    </script>


    <footer class="relative py-16 px-4 sm:px-6 lg:px-8">

        <div class="absolute top-6 left-6 z-20">
            <div class="footer-logo-box">
                <img src="logo.png" alt="CTC Logo" class="footer-logo-img">
            </div>
        </div>

        <div class="max-w-5xl mx-auto px-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div class="col-span-2 md:col-span-1">
                    <h4 class="font-semibold mb-4 text-lg">Calculators</h4>
                    <ul class="space-y-3">
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="ctc-to-inhand">CTC → In-hand</button></li>
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="inhand-to-ctc">In-hand → CTC</button></li>
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="compare">Compare Offers</button></li>
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="tax">Tax Calculator</button></li>
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="hike">Hike Calculator</button></li>
                        <li><button class="footer-tab-btn text-sm transition-colors" data-tab-target="additional">Additional Calculator</button></li>
                    </ul>
                </div>
                <div class="col-span-2 md:col-span-2 grid grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-semibold mb-4 text-lg">Resources</h4>
                        <ul class="space-y-3">
                            <li><a href="#" class="text-sm transition-colors">About Us</a></li>
                            <li><a href="#" class="text-sm transition-colors">Blog</a></li>
                            <li><a href="#" class="text-sm transition-colors">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4 text-lg">Legal</h4>
                        <ul class="space-y-3">
                            <li><a href="#" class="text-sm transition-colors">Privacy Policy</a></li>
                            <li><a href="#" class="text-sm transition-colors">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-span-2 md:col-span-1">
                    <h4 class="font-semibold mb-4 text-lg">Follow Us</h4>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-sm transition-colors">Twitter</a></li>
                        <li><a href="#" class="text-sm transition-colors">LinkedIn</a></li>
                        <li><a href="#" class="text-sm transition-colors">GitHub</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-12 pt-8 text-center">
                <hr class="border-gray-200/80 dark:border-gray-700/80 mb-6" style="background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); height: 1px; border: none;">
                <p class="text-sm">&copy; 2025 CTC Calculator. All rights reserved.</p>
            </div>
        </div>
    </footer>


    <div id="taxDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="text-xl font-semibold mb-4" id="taxModalTitle">Detailed Tax Calculation</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="font-medium mb-2">Income Tax Slabs</h3>
                    <div id="taxSlabsBreakdown" class="text-sm space-y-2"></div>
                </div>
                <div>
                    <h3 class="font-medium mb-2">Additional Charges</h3>
                    <div id="additionalCharges" class="text-sm space-y-2">
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Tax before
                                Surcharge/Cess</span><span id="taxBeforeCharges">₹0</span></div>
                        <div class="flex justify-between"><span
                                class="text-gray-600 dark:text-gray-400">Surcharge</span><span
                                id="taxSurcharge">₹0</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Health &
                                Education Cess (4%)</span><span id="educationCess">₹0</span></div>
                    </div>
                </div>
                <div class="pt-4 border-t border-gray-200 dark:border-gray-600">
                    <div class="flex justify-between font-semibold">
                        <span>Total Tax Liability</span>
                        <span id="totalTaxLiability">₹0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- (Global) Helper Functions ---

        function formatIndianCurrency(num) {
            num = Math.round(num);
            const units = Math.abs(num) >= 1e7 ? Math.abs(num) / 1e7 : Math.abs(num) >= 1e5 ? Math.abs(num) / 1e5 : Math.abs(num) >= 1e3 ? Math.abs(num) / 1e3 : Math.abs(num);
            if (Math.abs(num) >= 1e7) {
                return '₹ ' + units.toFixed(2) + ' Cr';
            } else if (Math.abs(num) >= 1e5) {
                return '₹ ' + units.toFixed(2) + ' L';
            } else if (Math.abs(num) >= 1e3) {
                return '₹ ' + units.toFixed(0) + ' K';
            }
            return '₹ ' + num.toLocaleString('en-IN');
        }

        const f_simple = (val) => `₹${Math.round(val).toLocaleString('en-IN')}`;
        const neg_f_simple = (val) => `-₹${Math.round(val).toLocaleString('en-IN')}`;


        function updateSliderBackground(slider) {
            // Note: Slider is removed from final code, keeping function for completeness if it were re-added.
            // const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
            // slider.style.setProperty('--value', value + '%');
        }

        function getChartLabelColor() {
            if (document.documentElement.classList.contains('dark')) {
                return '#d1d5db'; // gray-300
            }
            return '#374151'; // gray-700
        }

        // --- Number to Words (Indian numbering) ---
        function numberToWordsIndian(num) {
            num = Number(num) || 0;
            if (num === 0) return 'Zero rupees';

            const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];

            function twoDigits(n) {
                if (n < 20) return a[n];
                return b[Math.floor(n / 10)] + (n % 10 ? ' ' + a[n % 10] : '');
            }

            function threeDigits(n) {
                let str = '';
                if (n > 99) {
                    str += a[Math.floor(n / 100)] + ' hundred';
                    if (n % 100) str += ' ';
                }
                if (n % 100) str += twoDigits(n % 100);
                return str;
            }

            const crore = Math.floor(num / 10000000);
            num = num % 10000000;
            const lakh = Math.floor(num / 100000);
            num = num % 100000;
            const thousand = Math.floor(num / 1000);
            const hund = Math.floor((num % 1000));

            const parts = [];
            if (crore) parts.push(twoDigits(crore) + ' crore');
            if (lakh) parts.push(twoDigits(lakh) + ' lakh');
            if (thousand) parts.push(twoDigits(thousand) + ' thousand');
            if (hund) parts.push(threeDigits(hund));

            const words = parts.join(' ').replace(/\s+/g, ' ').trim();
            // Capitalize first letter
            return words.charAt(0).toUpperCase() + words.slice(1) + ' rupees';
        }


        // --- (Global) CTC Calculator Logic ---

        document.addEventListener('DOMContentLoaded', () => {
            let calculationResults = {};
            let reverseCalculationResults = {}; // NAYA VARIABLE REVERSE DATA KE LIYE

            let salaryChart;
            let reverseSalaryChart;

            // --- Get All DOM Elements ---

            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            const headerEl = document.querySelector('header');

            // Toggle glassmorphism class on scroll
            function handleHeaderOnScroll() {
                try {
                    if (window.scrollY > 20) {
                        headerEl.classList.add('scrolled');
                    } else {
                        headerEl.classList.remove('scrolled');
                    }
                } catch (e) {
                    // defensive: if header not present, silently ignore
                    console.warn('Header scroll handler error', e);
                }
            }
            window.addEventListener('scroll', handleHeaderOnScroll, { passive: true });
            // initialize state
            handleHeaderOnScroll();


            // Tab 1 (CTC -> In-hand)
            // const ctcSlider = document.getElementById('ctcSlider'); // Removed from HTML, check if present
            const ctcInputBox = document.getElementById('ctcInputBox');
            const ctcInWords = document.getElementById('ctcInWords');
            const includePF = document.getElementById('includePF');
            const includeProfTax = document.getElementById('includeProfTax');
            const includeGratuity = document.getElementById('includeGratuity');
            const includeInsurance = document.getElementById('includeInsurance');
            const insuranceAmount = document.getElementById('insuranceAmount');
            const includeOtherDeductions = document.getElementById('includeOtherDeductions');
            const otherDeductionsAmount = document.getElementById('otherDeductionsAmount');
            const includeNps = document.getElementById('includeNps');
            const npsPercent = document.getElementById('npsPercent');
            const locationSelect = document.getElementById('location');
            const basicInput = document.getElementById('basicInput');
            const hraInput = document.getElementById('hraInput');
            const daInput = document.getElementById('daInput');
            const ltaInput = document.getElementById('ltaInput');
            const specialInput = document.getElementById('specialInput');
            const bonusInput = document.getElementById('bonusInput');
            const taxRegimeInputs = document.querySelectorAll('input[name="taxRegime"]');
            const inputModeInputs = document.querySelectorAll('input[name="inputMode"]');

            // Tab 2 (In-hand -> CTC)
            // const monthlyInHandSlider = document.getElementById('monthlyInHandSlider'); // Removed from HTML, check if present
            const monthlyInHandInputBox = document.getElementById('monthlyInHandInputBox');
            const monthlyInWords = document.getElementById('monthlyInWords');
            const reverseTaxRegimeInputs = document.querySelectorAll('input[name="taxRegime_reverse"]');
            const reverseLocationSelect = document.getElementById('location_reverse');
            const reverseIncludePF = document.getElementById('includePF_reverse');
            const reverseIncludeProfTax = document.getElementById('includeProfTax_reverse');
            const reverseCalcButton = document.getElementById('calculateReverse');

            // Mobile Menu Elements
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');


            // Modal
            const modal = document.getElementById('taxDetailsModal');
            const showTaxDetails = document.getElementById('showTaxDetails');
            const closeModal = document.querySelector('.close-modal');

            // Downloads
            const downloadPdfBtn = document.getElementById('downloadPdf');
            const downloadExcelBtn = document.getElementById('downloadExcel');
            // NAYE DOWNLOAD BUTTONS
            const downloadPdfBtn_reverse = document.getElementById('downloadPdf_reverse');
            const downloadExcelBtn_reverse = document.getElementById('downloadExcel_reverse');


            // --- Tax Slabs ---
            const oldTaxSlabs = [
                { limit: 250000, rate: 0 },
                { limit: 500000, rate: 0.05 },
                { limit: 1000000, rate: 0.20 },
                { limit: Infinity, rate: 0.30 }
            ];
            const newTaxSlabs = [
                { limit: 300000, rate: 0 },
                { limit: 600000, rate: 0.05 },
                { limit: 900000, rate: 0.10 },
                { limit: 1200000, rate: 0.15 },
                { limit: 1500000, rate: 0.20 },
                { limit: Infinity, rate: 0.30 }
            ];

            // --- (Section 0) Theme Toggle Logic ---
            function updateThemeIcon() {
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            }

            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                updateThemeIcon();

                if (salaryChart) {
                    salaryChart.options.plugins.legend.labels.color = getChartLabelColor();
                    salaryChart.update();
                }
                if (reverseSalaryChart) {
                    reverseSalaryChart.options.plugins.legend.labels.color = getChartLabelColor();
                    reverseSalaryChart.update();
                }
            });

            // --- (Section 1) Tab Switching & Mobile Menu Logic ---

            if (mobileMenuToggle && mobileMenu) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab') || button.getAttribute('data-tab-target');
                    if (!targetTab) return;

                    // Deactivate all tabs (in header and footer)
                    document.querySelectorAll('.tab-btn, .footer-tab-btn').forEach(btn => btn.classList.remove('tab-active'));

                    // Hide all panels
                    tabPanels.forEach(panel => panel.classList.add('hidden'));

                    // Activate clicked button
                    button.classList.add('tab-active');

                    // Activate matching header tab
                    const matchingHeaderTab = document.querySelector(`header .tab-btn[data-tab="${targetTab}"]`);
                    if (matchingHeaderTab) {
                        matchingHeaderTab.classList.add('tab-active');
                    }

                    // Activate matching footer tab
                    const matchingFooterTab = document.querySelector(`.footer-tab-btn[data-tab-target="${targetTab}"]`);
                    if (matchingFooterTab) {
                        matchingFooterTab.classList.add('tab-active'); // Not strictly needed, but good for consistency
                    }

                    // Show target panel
                    document.getElementById(targetTab).classList.remove('hidden');

                    // Close mobile menu on tab click
                    if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            // --- (Section 2) CTC -> In-Hand Calculator ---

            function updateInputLabels() {
                const mode = document.querySelector('input[name="inputMode"]:checked').value;
                const labelSymbol = (mode === 'percentage') ? '(%)' : '(₹)';
                document.querySelectorAll('.component-label').forEach(label => {
                    label.textContent = labelSymbol;
                });

                if (mode === 'percentage') {
                    basicInput.value = 40;
                    // HRA default: 40% of Basic (fixed rule)
                    hraInput.value = 40;
                    daInput.value = 10;
                    ltaInput.value = 5;
                    bonusInput.value = 10;
                    specialInput.value = 15;
                } else {
                    const ctc = parseFloat(ctcInputBox ? ctcInputBox.value : 0) || 0;
                    basicInput.value = (ctc * 0.40).toFixed(0);
                    // hra amount = 40% of basic
                    const basicAmount = (ctc * 0.40);
                    hraInput.value = Math.round(basicAmount * 0.40);
                    daInput.value = (ctc * 0.10).toFixed(0);
                    ltaInput.value = (ctc * 0.05).toFixed(0);
                    bonusInput.value = (ctc * 0.10).toFixed(0);
                    specialInput.value = (ctc * 0.15).toFixed(0);
                }
            }

            // Main calculation function
            function calculateSalary() {
                const ctc = parseFloat(ctcInputBox ? ctcInputBox.value : 0) || 0;
                const inputMode = document.querySelector('input[name="inputMode"]:checked').value;
                const taxRegime = document.querySelector('input[name="taxRegime"]:checked').value;
                const location = locationSelect.value;
                // Basic: percent of CTC or absolute
                const basic = (inputMode === 'percentage') ? ctc * (parseFloat(basicInput.value) / 100) : parseFloat(basicInput.value || 0);

                // HRA: 40% of Basic (fixed rule)
                const hra = basic * 0.40;

                // Allowances DA/LTA/Bonus based on input mode (percentage interpreted vs amounts)
                let da = 0, lta = 0, bonus = 0;
                if (inputMode === 'percentage') {
                    da = ctc * ((parseFloat(daInput.value) || 0) / 100);
                    lta = ctc * ((parseFloat(ltaInput.value) || 0) / 100);
                    bonus = ctc * ((parseFloat(bonusInput.value) || 0) / 100);
                } else {
                    da = parseFloat(daInput.value) || 0;
                    lta = parseFloat(ltaInput.value) || 0;
                    bonus = parseFloat(bonusInput.value) || 0;
                }

                // Employer side contributions (part of CTC)
                const employerPF = includePF.checked ? basic * 0.12 : 0;
                const employerGratuity = includeGratuity.checked ? basic * 0.0481 : 0;
                const insuranceEmployer = includeInsurance.checked ? (parseFloat(insuranceAmount.value) || 0) : 0;
                const otherEmployer = includeOtherDeductions.checked ? (parseFloat(otherDeductionsAmount.value) || 0) : 0;

                // Special allowance per user formula: CTC – (Basic + HRA + Employer PF + Gratuity + Insurance + Other Deductions)
                const special = Math.max(0, ctc - (basic + hra + employerPF + employerGratuity + insuranceEmployer + otherEmployer));

                const components = { basic, hra, da, lta, bonus, special };

                // Employee side deductions
                const employeePF = includePF.checked ? basic * 0.12 : 0;
                const npsDeduction = includeNps.checked ? Math.min(((parseFloat(npsPercent.value) || 0) / 100) * basic, 0.12 * basic) : 0;
                let profTax = 0;
                if (includeProfTax.checked) {
                    const rates = { 'TN': 2500, 'KA': 2400, 'MH': 2500, 'DL': 2400 };
                    profTax = rates[location] || 0;
                }
                // Gross salary computed as sum of components (should align with CTC - employer contributions)
                const grossSalary = components.basic + components.hra + components.da + components.lta + components.bonus + components.special;

                // (CHANGE) Using 75000, standard deduction for tax purposes
                const standardDeduction = 75000;
                let taxableIncome = grossSalary;
                let taxDetails = {};

                if (taxRegime === 'old') {
                    const hraExemption = Math.min(components.hra, (components.basic + components.da) * 0.50);
                    const ltaExemption = components.lta;

                    // (REVERT) Reverted to original logic: 80C is only EPF, capped at 1.5L
                    const section80C = Math.min(employeePF, 150000);

                    taxableIncome -= (standardDeduction + hraExemption + ltaExemption + section80C + profTax);

                    taxDetails = calculateTax(taxableIncome, oldTaxSlabs);
                    // Rebate u/s 87A
                    if (taxableIncome <= 500000) taxDetails.finalTax = Math.max(0, taxDetails.finalTax - 12500);

                } else { // New Regime
                    // New regime also gets standard deduction
                    taxableIncome -= (standardDeduction + profTax);
                    taxDetails = calculateTax(taxableIncome, newTaxSlabs);
                    // Rebate u/s 87A
                    if (taxableIncome <= 700000) taxDetails.finalTax = 0;
                }

                taxableIncome = Math.max(0, taxableIncome);
                const totalTax = taxDetails.finalTax;
                const totalDeductions = employeePF + npsDeduction + profTax + totalTax;
                const netInHandYearly = grossSalary - totalDeductions;
                const netInHandMonthly = netInHandYearly / 12;

                calculationResults = {
                    ctc, taxRegime, components, grossSalary, employerPF, employerGratuity, insuranceEmployer, otherEmployer,
                    deductions: { employeePF, npsDeduction, profTax, totalTax, total: totalDeductions },
                    taxCalc: { taxableIncome, standardDeduction, ...taxDetails },
                    netInHandYearly, netInHandMonthly
                };

                updateUI(calculationResults);
            }

            // Generic tax calculation logic
            function calculateTax(income, slabs) {
                let tax = 0, remainingIncome = income, previousLimit = 0, slabBreakdown = [];
                for (const slab of slabs) {
                    if (remainingIncome <= 0) break;
                    const taxableInSlab = Math.min(remainingIncome, slab.limit - previousLimit);
                    const taxInSlab = taxableInSlab * slab.rate;
                    tax += taxInSlab;
                    slabBreakdown.push({
                        range: `₹${previousLimit.toLocaleString('en-IN')} - ₹${slab.limit === Infinity ? 'Above' : slab.limit.toLocaleString('en-IN')}`,
                        rate: slab.rate * 100, tax: taxInSlab
                    });
                    remainingIncome -= taxableInSlab;
                    previousLimit = slab.limit;
                }
                const taxBeforeCharges = tax;
                let surcharge = 0;
                if (income > 5000000 && income <= 10000000) surcharge = tax * 0.10;
                else if (income > 10000000 && income <= 20000000) surcharge = tax * 0.15;
                else if (income > 20000000 && income <= 50000000) surcharge = tax * 0.25;
                else if (income > 50000000) surcharge = tax * 0.37;
                tax += surcharge;
                const cess = tax * 0.04;
                const finalTax = tax + cess;
                return { taxBeforeCharges, surcharge, cess, finalTax, slabBreakdown };
            }

            // Update UI for Tab 1
            function updateUI(results) {
                const { components, taxRegime, grossSalary, employerPF, deductions, taxCalc, netInHandYearly, netInHandMonthly, ctc } = results;
                document.getElementById('regimeTitle').textContent = `Salary Breakdown under ${taxRegime === 'old' ? 'Old' : 'New'} Tax Regime`;
                document.getElementById('monthlyInHand').textContent = formatIndianCurrency(netInHandMonthly);
                document.getElementById('netYearly').textContent = formatIndianCurrency(netInHandYearly);
                document.getElementById('basicAmount').textContent = f_simple(components.basic);
                document.getElementById('hraAmount').textContent = f_simple(components.hra);
                document.getElementById('daAmount').textContent = f_simple(components.da);
                document.getElementById('ltaAmount').textContent = f_simple(components.lta);
                document.getElementById('specialAmount').textContent = f_simple(components.special);
                document.getElementById('bonusAmount').textContent = f_simple(components.bonus);
                document.getElementById('grossYearly').textContent = f_simple(grossSalary);
                document.getElementById('grossForTax').textContent = f_simple(grossSalary);
                document.getElementById('standardDeduction').textContent = neg_f_simple(taxCalc.standardDeduction);
                document.getElementById('taxableIncome').textContent = f_simple(taxCalc.taxableIncome);
                document.getElementById('epfEmployee').textContent = neg_f_simple(deductions.employeePF);
                document.getElementById('epfEmployer').textContent = f_simple(employerPF);
                // Employer gratuity/insurance/other displays
                if (document.getElementById('gratuityEmployer')) document.getElementById('gratuityEmployer').textContent = f_simple(results.employerGratuity || 0);
                if (document.getElementById('gratuityEmployerCtc')) document.getElementById('gratuityEmployerCtc').textContent = f_simple(results.employerGratuity || 0);
                if (document.getElementById('insuranceEmployer')) document.getElementById('insuranceEmployer').textContent = f_simple(results.insuranceEmployer || 0);
                if (document.getElementById('insuranceEmployerCtc')) document.getElementById('insuranceEmployerCtc').textContent = f_simple(results.insuranceEmployer || 0);
                if (document.getElementById('otherEmployerDeduction')) document.getElementById('otherEmployerDeduction').textContent = f_simple(results.otherEmployer || 0);
                if (document.getElementById('npsDeduction')) document.getElementById('npsDeduction').textContent = neg_f_simple(deductions.npsDeduction || 0);
                document.getElementById('profTaxAmount').textContent = neg_f_simple(deductions.profTax);
                document.getElementById('incomeTax').textContent = neg_f_simple(deductions.totalTax);
                document.getElementById('deductionsYearly').textContent = neg_f_simple(deductions.total);
                document.getElementById('grossSalaryCtc').textContent = f_simple(grossSalary);
                document.getElementById('employerEpfCtc').textContent = f_simple(employerPF);
                document.getElementById('totalCtc').textContent = f_simple(ctc);
                updateChart(results);
            }

            // --- (Section 3) Chart.js ---
            function initializeChart() {
                const ctx = document.getElementById('salaryChart').getContext('2d');
                salaryChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Net In-Hand', 'Employee PF', 'Prof. Tax', 'Income Tax'],
                        datasets: [{
                            data: [1, 0, 0, 0],
                            backgroundColor: ['#0d9488', '#f59e0b', '#eab308', '#ef4444'], // Teal, Amber, Yellow, Red
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 10 },
                                    color: getChartLabelColor() // Dynamic color
                                }
                            }
                        }
                    }
                });
            }

            function updateChart(results) {
                if (!salaryChart) {
                    initializeChart();
                }
                salaryChart.data.datasets[0].data = [
                    results.netInHandYearly,
                    results.deductions.employeePF,
                    results.deductions.profTax,
                    results.deductions.totalTax
                ];
                salaryChart.update();
            }

            function initializeReverseChart() {
                const ctx = document.getElementById('reverseSalaryChart').getContext('2d');
                reverseSalaryChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Net In-Hand', 'Employee PF', 'Prof. Tax', 'Income Tax'],
                        datasets: [{
                            data: [1, 0, 0, 0],
                            backgroundColor: ['#0d9488', '#f59e0b', '#eab308', '#ef4444'], // Teal, Amber, Yellow, Red
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 10 },
                                    color: getChartLabelColor() // Dynamic color
                                }
                            }
                        }
                    }
                });
            }

            function updateReverseChart(results) {
                if (!reverseSalaryChart) {
                    initializeReverseChart();
                }
                reverseSalaryChart.data.datasets[0].data = [
                    results.netInHandYearly,
                    results.deductions.employeePF,
                    results.deductions.profTax,
                    results.deductions.totalTax
                ];
                reverseSalaryChart.update();
            }

            // --- (Section 4) In-hand -> CTC Calculator ---

            function handleReverseCalculation() {
                const targetInHandMonthly = parseFloat(monthlyInHandInputBox ? monthlyInHandInputBox.value : 0) || 0;
                if (targetInHandMonthly === 0) return;

                const params = {
                    taxRegime: document.querySelector('input[name="taxRegime_reverse"]:checked').value,
                    location: reverseLocationSelect.value,
                    pf: reverseIncludePF.checked,
                    profTax: reverseIncludeProfTax.checked
                };

                let minCTC = targetInHandMonthly * 12;
                let maxCTC = targetInHandMonthly * 24;
                let finalResults = {};

                for (let i = 0; i < 30; i++) {
                    let trialCTC = (minCTC + maxCTC) / 2;
                    finalResults = calculateInHandFromCTC(trialCTC, params);
                    let currentInHand = finalResults.netInHandMonthly;
                    if (Math.abs(currentInHand - targetInHandMonthly) < 0.01) {
                        break;
                    }
                    if (currentInHand < targetInHandMonthly) {
                        minCTC = trialCTC;
                    } else {
                        maxCTC = trialCTC;
                    }
                }

                reverseCalculationResults = finalResults; // DATA KO STORE KIYA
                updateReverseUI(finalResults, targetInHandMonthly);
            }

            function calculateInHandFromCTC(trialCTC, params) {
                const { taxRegime, location, pf, profTax } = params;
                const basicPerc = 40, hraPerc = 20, daPerc = 10, ltaPerc = 5, bonusPerc = 10, specialPerc = 15;
                let employerPF = 0, tempBasic = 0;
                if (pf) {
                    tempBasic = trialCTC * (basicPerc / 100);
                    employerPF = tempBasic * 0.12;
                }
                const grossSalary = trialCTC - employerPF;

                const components = {
                    basic: grossSalary * (basicPerc / 100),
                    hra: grossSalary * (hraPerc / 100),
                    da: grossSalary * (daPerc / 100),
                    lta: grossSalary * (ltaPerc / 100),
                    bonus: grossSalary * (bonusPerc / 100),
                    special: grossSalary * (specialPerc / 100)
                };

                const employeePF = pf ? components.basic * 0.12 : 0;
                let professionalTax = 0;
                if (profTax) {
                    const rates = { 'TN': 2500, 'KA': 2400, 'MH': 2500, 'DL': 2400 };
                    professionalTax = rates[location] || 0;
                }

                const standardDeduction = 50000;
                let taxableIncome = grossSalary;
                let taxDetails = {};

                if (taxRegime === 'old') {
                    const hraExemption = Math.min(components.hra, (components.basic + components.da) * 0.50);
                    const ltaExemption = components.lta;
                    const section80C = Math.min(employeePF, 150000);
                    taxableIncome -= (standardDeduction + hraExemption + ltaExemption + section80C + professionalTax);
                    taxDetails = calculateTax(taxableIncome, oldTaxSlabs);
                    if (taxableIncome <= 500000) taxDetails.finalTax = Math.max(0, taxDetails.finalTax - 12500);
                } else {
                    taxableIncome -= (standardDeduction + professionalTax);
                    taxDetails = calculateTax(taxableIncome, newTaxSlabs);
                    if (taxableIncome <= 700000) taxDetails.finalTax = 0;
                }

                taxableIncome = Math.max(0, taxableIncome);
                const totalTax = taxDetails.finalTax;
                const totalDeductions = employeePF + professionalTax + totalTax;
                const netInHandYearly = grossSalary - totalDeductions;
                const netInHandMonthly = netInHandYearly / 12;

                return {
                    ctc: trialCTC, taxRegime, components, grossSalary, employerPF,
                    deductions: { employeePF, profTax: professionalTax, totalTax, total: totalDeductions },
                    netInHandYearly, netInHandMonthly
                };
            }

            function updateReverseUI(results, targetInHand) {
                const { ctc, taxRegime, components, grossSalary, employerPF, deductions, netInHandMonthly } = results;

                document.getElementById('reverseResultCard').classList.remove('hidden');
                document.getElementById('reverseRegimeTitle').textContent = `Required CTC Breakdown (${taxRegime} Regime)`;
                document.getElementById('calculatedCTC').textContent = formatIndianCurrency(ctc);
                document.getElementById('calculatedMonthlyInHand').textContent = formatIndianCurrency(netInHandMonthly);

                document.getElementById('reverse_basicAmount').textContent = f_simple(components.basic);
                document.getElementById('reverse_hraAmount').textContent = f_simple(components.hra);
                const otherAllowances = components.da + components.lta + components.special + components.bonus;
                document.getElementById('reverse_specialAmount').textContent = f_simple(otherAllowances);
                document.getElementById('reverse_grossYearly').textContent = f_simple(grossSalary);

                document.getElementById('reverse_epfEmployee').textContent = neg_f_simple(deductions.employeePF);
                document.getElementById('reverse_profTaxAmount').textContent = neg_f_simple(deductions.profTax);
                document.getElementById('reverse_incomeTax').textContent = neg_f_simple(deductions.totalTax);
                document.getElementById('reverse_deductionsYearly').textContent = neg_f_simple(deductions.total);

                document.getElementById('reverse_grossSalaryCtc').textContent = f_simple(grossSalary);
                document.getElementById('reverse_employerEpfCtc').textContent = f_simple(employerPF);
                document.getElementById('reverse_totalCtc').textContent = f_simple(ctc);

                updateReverseChart(results);
            }


            // --- (Section 5) Modal Logic ---
            showTaxDetails.addEventListener('click', () => {
                populateTaxModal(calculationResults);
                modal.style.display = 'block';
            });
            closeModal.addEventListener('click', () => modal.style.display = 'none');
            window.addEventListener('click', (event) => {
                if (event.target === modal) modal.style.display = 'none';
            });

            function populateTaxModal(results) {
                if (!results.taxCalc) return;
                const { taxRegime, taxCalc } = results;
                const { slabBreakdown, taxBeforeCharges, surcharge, cess, finalTax } = taxCalc;
                document.getElementById('taxModalTitle').textContent = `Detailed Tax Calculation (${taxRegime} Regime)`;
                const slabsContainer = document.getElementById('taxSlabsBreakdown');
                slabsContainer.innerHTML = '';
                slabBreakdown.forEach(slab => {
                    const row = document.createElement('div');
                    row.className = 'flex justify-between items-center';
                    row.innerHTML = `
                        <span class="text-gray-600 dark:text-gray-400">${slab.range}</span>
                        <span class="text-sm bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">@ ${slab.rate}%</span>
                        <span class="font-medium text-gray-800 dark:text-gray-200">${f_simple(slab.tax)}</span>`;
                    slabsContainer.appendChild(row);
                });
                document.getElementById('taxBeforeCharges').textContent = f_simple(taxBeforeCharges);
                document.getElementById('taxSurcharge').textContent = f_simple(surcharge);
                document.getElementById('educationCess').textContent = f_simple(cess);
                document.getElementById('totalTaxLiability').textContent = f_simple(finalTax);
            }

            // --- (Section 6) Download Logic ---
            downloadPdfBtn.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const { components, grossSalary, employerPF, deductions, netInHandYearly, netInHandMonthly, ctc, taxRegime } = calculationResults;

                if (!ctc) { alert('Please calculate CTC first.'); return; }

                doc.setFontSize(18);
                doc.text('Salary Breakdown (CTC to In-hand)', 105, 20, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Tax Regime: ${taxRegime === 'old' ? 'Old' : 'New'}`, 105, 30, { align: 'center' });
                let y = 45;
                doc.setFontSize(14); doc.text('Summary', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text(`Total CTC:`, 20, y); doc.text(f_simple(ctc), 180, y, { align: 'right' }); y += 8;
                doc.text(`Net Annual Salary:`, 20, y); doc.text(f_simple(netInHandYearly), 180, y, { align: 'right' }); y += 8;
                doc.text(`Net Monthly Salary:`, 20, y); doc.text(f_simple(netInHandMonthly), 180, y, { align: 'right' }); y += 15;
                doc.setFontSize(14); doc.text('Earnings (Annual)', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Basic Salary:', 20, y); doc.text(f_simple(components.basic), 180, y, { align: 'right' }); y += 8;
                doc.text('HRA:', 20, y); doc.text(f_simple(components.hra), 180, y, { align: 'right' }); y += 8;
                doc.text('DA:', 20, y); doc.text(f_simple(components.da), 180, y, { align: 'right' }); y += 8;
                doc.text('LTA:', 20, y); doc.text(f_simple(components.lta), 180, y, { align: 'right' }); y += 8;
                doc.text('Special Allowance:', 20, y); doc.text(f_simple(components.special), 180, y, { align: 'right' }); y += 8;
                doc.text('Performance Bonus:', 20, y); doc.text(f_simple(components.bonus), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Gross Salary:', 20, y); doc.text(f_simple(grossSalary), 180, y, { align: 'right' }); y += 15;
                doc.setFont(undefined, 'normal'); doc.setFontSize(14);
                doc.text('Deductions (Annual)', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Employee EPF:', 20, y); doc.text(f_simple(deductions.employeePF), 180, y, { align: 'right' }); y += 8;
                doc.text('Professional Tax:', 20, y); doc.text(f_simple(deductions.profTax), 180, y, { align: 'right' }); y += 8;
                doc.text('Income Tax:', 20, y); doc.text(f_simple(deductions.totalTax), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Total Deductions:', 20, y); doc.text(f_simple(deductions.total), 180, y, { align: 'right' }); y += 15;
                doc.setFont(undefined, 'normal'); doc.setFontSize(14);
                doc.text('CTC Breakup', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Gross Salary:', 20, y); doc.text(f_simple(grossSalary), 180, y, { align: 'right' }); y += 8;
                doc.text('Employer EPF:', 20, y); doc.text(f_simple(employerPF), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Total CTC:', 20, y); doc.text(f_simple(ctc), 180, y, { align: 'right' });
                doc.save('salary-breakdown-ctc-to-inhand.pdf');
            });

            downloadExcelBtn.addEventListener('click', () => {
                const { components, grossSalary, employerPF, deductions, netInHandYearly, netInHandMonthly, ctc, taxRegime } = calculationResults;

                if (!ctc) { alert('Please calculate CTC first.'); return; }

                const wb = XLSX.utils.book_new();
                const wsData = [
                    ['Salary Breakdown (CTC to In-hand)'], ['Tax Regime', taxRegime], [],
                    ['Summary', 'Amount'], ['Total CTC', ctc], ['Net Annual Salary', netInHandYearly], ['Net Monthly Salary', netInHandMonthly], [],
                    ['Earnings (Annual)', 'Amount'], ['Basic Salary', components.basic], ['HRA', components.hra], ['DA', components.da], ['LTA', components.lta], ['Special Allowance', components.special], ['Performance Bonus', components.bonus], ['Gross Salary', grossSalary], [],
                    ['Deductions (Annual)', 'Amount'], ['Employee EPF', deductions.employeePF], ['Professional Tax', deductions.profTax], ['Income Tax', deductions.totalTax], ['Total Deductions', deductions.total], [],
                    ['CTC Breakup', 'Amount'], ['Gross Salary', grossSalary], ['Employer EPF', employerPF], ['Total CTC', ctc]
                ];
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                XLSX.utils.book_append_sheet(wb, ws, 'Salary Breakdown');
                XLSX.writeFile(wb, 'salary-breakdown-ctc-to-inhand.xlsx');
            });

            // --- NAYE DOWNLOAD LISTENERS (REVERSE) ---
            downloadPdfBtn_reverse.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const { ctc, taxRegime, components, grossSalary, employerPF, deductions, netInHandYearly, netInHandMonthly } = reverseCalculationResults;

                if (!ctc) { alert('Please calculate a CTC first.'); return; }

                doc.setFontSize(18);
                doc.text('Salary Breakdown (In-hand to CTC)', 105, 20, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Tax Regime: ${taxRegime === 'old' ? 'Old' : 'New'}`, 105, 30, { align: 'center' });
                let y = 45;
                doc.setFontSize(14); doc.text('Summary', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text(`Required Total CTC:`, 20, y); doc.text(f_simple(ctc), 180, y, { align: 'right' }); y += 8;
                doc.text(`Net Annual Salary:`, 20, y); doc.text(f_simple(netInHandYearly), 180, y, { align: 'right' }); y += 8;
                doc.text(`Net Monthly Salary:`, 20, y); doc.text(f_simple(netInHandMonthly), 180, y, { align: 'right' }); y += 15;

                doc.setFontSize(14); doc.text('Earnings (Annual)', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Basic Salary:', 20, y); doc.text(f_simple(components.basic), 180, y, { align: 'right' }); y += 8;
                doc.text('HRA:', 20, y); doc.text(f_simple(components.hra), 180, y, { align: 'right' }); y += 8;
                const otherAllowances = components.da + components.lta + components.special + components.bonus;
                doc.text('Other Allowances:', 20, y); doc.text(f_simple(otherAllowances), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Gross Salary:', 20, y); doc.text(f_simple(grossSalary), 180, y, { align: 'right' }); y += 15;

                doc.setFont(undefined, 'normal'); doc.setFontSize(14);
                doc.text('Deductions (Annual)', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Employee EPF:', 20, y); doc.text(f_simple(deductions.employeePF), 180, y, { align: 'right' }); y += 8;
                doc.text('Professional Tax:', 20, y); doc.text(f_simple(deductions.profTax), 180, y, { align: 'right' }); y += 8;
                doc.text('Income Tax:', 20, y); doc.text(f_simple(deductions.totalTax), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Total Deductions:', 20, y); doc.text(f_simple(deductions.total), 180, y, { align: 'right' }); y += 15;

                doc.setFont(undefined, 'normal'); doc.setFontSize(14);
                doc.text('CTC Breakup', 20, y); y += 10;
                doc.setFontSize(12);
                doc.text('Gross Salary:', 20, y); doc.text(f_simple(grossSalary), 180, y, { align: 'right' }); y += 8;
                doc.text('Employer EPF:', 20, y); doc.text(f_simple(employerPF), 180, y, { align: 'right' }); y += 8;
                doc.setFont(undefined, 'bold');
                doc.text('Total CTC:', 20, y); doc.text(f_simple(ctc), 180, y, { align: 'right' });

                doc.save('salary-breakdown-inhand-to-ctc.pdf');
            });

            downloadExcelBtn_reverse.addEventListener('click', () => {
                const { ctc, taxRegime, components, grossSalary, employerPF, deductions, netInHandYearly, netInHandMonthly } = reverseCalculationResults;

                if (!ctc) { alert('Please calculate a CTC first.'); return; }

                const wb = XLSX.utils.book_new();
                const otherAllowances = components.da + components.lta + components.special + components.bonus;

                const wsData = [
                    ['Salary Breakdown (In-hand to CTC)'], ['Tax Regime', taxRegime], [],
                    ['Summary', 'Amount'], ['Required Total CTC', ctc], ['Net Annual Salary', netInHandYearly], ['Net Monthly Salary', netInHandMonthly], [],
                    ['Earnings (Annual)', 'Amount'], ['Basic Salary', components.basic], ['HRA', components.hra], ['Other Allowances', otherAllowances], ['Gross Salary', grossSalary], [],
                    ['Deductions (Annual)', 'Amount'], ['Employee EPF', deductions.employeePF], ['Professional Tax', deductions.profTax], ['Income Tax', deductions.totalTax], ['Total Deductions', deductions.total], [],
                    ['CTC Breakup', 'Amount'], ['Gross Salary', grossSalary], ['Employer EPF', employerPF], ['Total CTC', ctc]
                ];
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                XLSX.utils.book_append_sheet(wb, ws, 'Salary Breakdown');
                XLSX.writeFile(wb, 'salary-breakdown-inhand-to-ctc.xlsx');
            });

            // --- (Section 7) Initial Load & Event Listeners ---

            function initializeCalculator() {

                // --- Tab 1 Listeners ---
                const tab1Inputs = [
                    includePF, includeProfTax, locationSelect,
                    basicInput, hraInput, daInput, ltaInput, bonusInput,
                    includeGratuity, includeInsurance, insuranceAmount,
                    includeOtherDeductions, otherDeductionsAmount,
                    includeNps, npsPercent
                ];
                tab1Inputs.forEach(input => input.addEventListener('input', calculateSalary));

                taxRegimeInputs.forEach(input => input.addEventListener('change', calculateSalary));

                inputModeInputs.forEach(input => input.addEventListener('change', () => {
                    updateInputLabels();
                    calculateSalary();
                }));

                // ctcInputBox (number-only) listeners
                if (ctcInputBox) {
                    ctcInputBox.addEventListener('input', (e) => {
                        // live update words and recalc
                        try { if (ctcInWords) ctcInWords.textContent = numberToWordsIndian(e.target.value); } catch (e) { }
                        calculateSalary();
                    });
                    ctcInputBox.addEventListener('change', (e) => {
                        let value = parseInt(e.target.value);
                        const min = parseInt(e.target.min || 0);
                        const max = parseInt(e.target.max || Number.MAX_SAFE_INTEGER);
                        if (isNaN(value) || value < min) value = min;
                        if (value > max) value = max;
                        e.target.value = value;
                        try { if (ctcInWords) ctcInWords.textContent = numberToWordsIndian(e.target.value); } catch (e) { }
                        calculateSalary();
                    });
                }


                // --- Tab 2 Listeners ---
                const tab2Inputs = [
                    reverseLocationSelect, reverseIncludePF,
                    reverseIncludeProfTax
                ];
                tab2Inputs.forEach(input => input.addEventListener('input', handleReverseCalculation));
                reverseTaxRegimeInputs.forEach(input => input.addEventListener('change', handleReverseCalculation));
                reverseCalcButton.addEventListener('click', handleReverseCalculation);
                // monthlyInHandInputBox listeners (number-only)
                if (monthlyInHandInputBox) {
                    monthlyInHandInputBox.addEventListener('input', (e) => {
                        try { if (monthlyInWords) monthlyInWords.textContent = numberToWordsIndian(e.target.value); } catch (e) { }
                        handleReverseCalculation();
                    });
                    monthlyInHandInputBox.addEventListener('change', (e) => {
                        let value = parseInt(e.target.value);
                        const min = parseInt(e.target.min || 0);
                        const max = parseInt(e.target.max || Number.MAX_SAFE_INTEGER);
                        if (isNaN(value) || value < min) value = min;
                        if (value > max) value = max;
                        e.target.value = value;
                        try { if (monthlyInWords) monthlyInWords.textContent = numberToWordsIndian(e.target.value); } catch (e) { }
                        handleReverseCalculation();
                    });
                }

                // --- Footer Link Logic ---
                const footerTabButtons = document.querySelectorAll('.footer-tab-btn');
                footerTabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const targetTab = e.target.getAttribute('data-tab-target');
                        const headerButton = document.querySelector(`header .tab-btn[data-tab="${targetTab}"]`);
                        if (headerButton) {
                            headerButton.click(); // This triggers the main tab-switching logic
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    });
                });


                // --- Initial Calls ---
                updateThemeIcon();
                updateInputLabels();
                initializeChart();

                // Initialize displays and calculations
                try { if (ctcInWords) ctcInWords.textContent = numberToWordsIndian(ctcInputBox ? ctcInputBox.value : 0); } catch (e) { }
                try { if (monthlyInWords) monthlyInWords.textContent = numberToWordsIndian(monthlyInHandInputBox ? monthlyInHandInputBox.value : 0); } catch (e) { }
                calculateSalary();
                handleReverseCalculation();
            }

            initializeCalculator();
        });
    </script>
</body>

</html>